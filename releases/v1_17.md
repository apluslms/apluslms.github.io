# A+ v1.17 Release Notes

**UNDER CONSTRUCTION**

November 2022 ([GitHub milestone](https://github.com/apluslms/a-plus/milestone/13?closed=1))

## A+ v1.17.0

* [A+ v1.17.0](https://github.com/apluslms/a-plus/releases/tag/v1.17.0)
* [MOOC-Grader v1.17.0](https://github.com/apluslms/mooc-grader/releases/tag/v1.17.0)
* [Git Manager v1.17.0](https://github.com/apluslms/gitmanager/releases/tag/v1.17.0) (see also newer patches)
* [a-plus-rst-tools v1.5.1](https://github.com/apluslms/a-plus-rst-tools/releases/tag/v1.5.1)

### Changes

* **Automatic retries of incomplete grading jobs**:
  A+ tries to detect submissions that seem to be stuck in grading,
  in other words, submissions that haven't received the grading results
  from the assessment service.
  Those submissions are periodically automatically uploaded to grading again.
  ([#988](https://github.com/apluslms/a-plus/issues/988))
* When the teacher creates new A+ course news items
  (that are shown in the course front page),
  the message may also be emailed to the course participants.


### Git Manager v1.17.0

This release focuses on improving slow course build times.
Gitmanager v1.17.0 is compatible with A-plus [v1.16.3](v1_16.md) and MOOC-Grader v1.16.0.

#### Changes

* Enabled multiple concurrent course build jobs.
  - Previously, only one build job could be running in the system at a time.
    Now, multiple course instances may have build jobs running concurrently.
    One course instance may have at most one build job running.
* Added option to specify exclude patterns for git clean.
  - New option `exclude_patterns` in apps.meta under the course git repo.
  - Matched files are not removed during the clean at the start of a build.
  - For example, `exclude_patterns = _build exercises` lists two separate directories, `_build` and `exercises`.
  - This may be used to avoid deleting some of the previously built output files if their removal is time consuming.
* Added option to build directly in the course publish directory.
  - Option "skip build failsafes" in the Git manager course instance settings.
  - When enabled, the recovery functionality does not work anymore:
    if the course build breaks something, the course will be broken until it is fixed with a new build.
  - Graders are configured during the aplus-json request (course import in the A+ frontend):
    every time someone clicks "apply" under the A+ Edit course section, the grader is configured again.
  - This mode speeds up the build time because there is no need to copy files between directories,
    and the grader is only configured during the aplus-json request.
  - It is not recommended to import the course in the A+ frontend (that is, send the aplus-json request)
    while a course is building in the gitmanager if this option is enabled.
    Since the build directly modifies the publish directory,
    the results of aplus-json become unpredictable during a running build.

#### For system administrators

* Added Django manage.py command for flushing the Huey storage: `manage.py flush_huey`
  - Huey is the framework used for asynchronous task queue.
  - Huey stores a lock for the course build job so that multiple builds are not started concurrently.
  - If a course build is killed abrutly, the lock may stay in the storage and prevent new builds from starting.
  - The command is used to flush build job locks from the storage,
    which allows new builds to start when the locks have become stuck.
  - This should be only rarely needed.
* If the new option "skip build failsafes" is used,
  it may be necessary to modify the build script
  in order to enable mounting the publish directory (setting `COURSES_PATH`) to the build container.
  Normally, the build is run in the separate build directory (`BUILD_PATH`)
  and not directly under the publish directory.
  The build script is defined with the setting `BUILD_MODULE`.
  It may be used to change the default script `scripts/docker_build.py`.


## Git Manager v1.17.2 patch

Git tag: [Git Manager v1.17.2](https://github.com/apluslms/gitmanager/releases/tag/v1.17.2)

Fixed failures in accessing the course during a running course build in the end of the build publish stage.

If the course includes or creates hundreds of files in the build,
the course used to become temporarily broken at the end of the course build
while temporary files were being removed.
This has been fixed so that the previous course build is available
until the new course build has been finished
and the Gitmanager course cache has been updated.

This issue affected mainly complex course implementations such as the Aalto Programming 1 (O1) course.

### For developers

Added support for the LTI parameters in MOOC-Grader [v1.16.1](v1_16.md).
Gitmanager exports the configured LTI settings in the aplus-json output for MOOC-Grader assignments
so that the A+ front sets those assignments as LTI assignments.
